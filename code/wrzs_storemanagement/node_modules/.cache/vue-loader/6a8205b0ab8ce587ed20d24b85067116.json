{"remainingRequest":"D:\\coding\\wrzs\\wrzs_storemanagement\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\coding\\wrzs\\wrzs_storemanagement\\src\\views\\store-manage\\dcard-manage\\dcard-manage-index.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\coding\\wrzs\\wrzs_storemanagement\\src\\views\\store-manage\\dcard-manage\\dcard-manage-index.vue","mtime":1686935646981},{"path":"D:\\coding\\wrzs\\wrzs_storemanagement\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1686936409160},{"path":"D:\\coding\\wrzs\\wrzs_storemanagement\\node_modules\\babel-loader\\lib\\index.js","mtime":1686936409992},{"path":"D:\\coding\\wrzs\\wrzs_storemanagement\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1686936409160},{"path":"D:\\coding\\wrzs\\wrzs_storemanagement\\node_modules\\vue-loader\\lib\\index.js","mtime":1686936410308}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQge21hcFN0YXRlfSBmcm9tICJ2dWV4Ig0KaW1wb3J0IHtnZXREY2FyZExpc3QsIGFkZERjYXJkLCBkZWxEY2FyZH0gZnJvbSAiQC9hcGkvc3RvcmUtbWFuYWdlL2RjYXJkLW1hbmFnZSINCg0KZXhwb3J0IGRlZmF1bHQgew0KICBuYW1lOiAiZGNhcmQtbWFuYWdlLWluZGV4IiwNCiAgY29tcHV0ZWQ6IHsNCiAgICAuLi5tYXBTdGF0ZSh7DQogICAgICBzdG9yZU1hbmFnZTogc3RhdGUgPT4gc3RhdGVbJ3N0b3JlLW1hbmFnZS9zdG9yZS1tYW5hZ2UnXS5zdG9yZU1hbmFnZSwNCiAgICAgIHJvb21NYW5hZ2U6IHN0YXRlID0+IHN0YXRlWydzdG9yZS1tYW5hZ2Uvcm9vbS1tYW5hZ2UnXS5yb29tTWFuYWdlLA0KICAgICAgZGNhcmRNYW5hZ2U6IHN0YXRlID0+IHN0YXRlWydzdG9yZS1tYW5hZ2UvZGNhcmQtbWFuYWdlJ10uZGNhcmRNYW5hZ2UNCiAgICB9KQ0KICB9LA0KICBkYXRhKCkgew0KICAgIHJldHVybiB7DQogICAgICBhZGREY2FyZERpYWxvZzogew0KICAgICAgICBzaG93OiBmYWxzZSwNCiAgICAgICAgZm9ybTogew0KICAgICAgICAgIGNhcmRfc246ICcnLA0KICAgICAgICAgIGVuZF90aW1lOiAnJw0KICAgICAgICB9LA0KICAgICAgICBmb3JtUnVsZXM6IHsNCiAgICAgICAgICBjYXJkX3NuOiBbew0KICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsDQogICAgICAgICAgICBtZXNzYWdlOiAn6K+36L6T5YWl6Zeo5Y2h5bqP5YiX5Y+3Jw0KICAgICAgICAgIH1dLA0KICAgICAgICAgIGVuZF90aW1lOiBbew0KICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsDQogICAgICAgICAgICBtZXNzYWdlOiAn6K+36YCJ5oup6Zeo5Y2h6L+H5pyf5pe26Ze0Jw0KICAgICAgICAgIH1dDQogICAgICAgIH0NCiAgICAgIH0sDQogICAgICBwaWNrZXJPcHRpb25zOiB7DQogICAgICAgIGRpc2FibGVkRGF0ZSh0aW1lKSB7DQogICAgICAgICAgcmV0dXJuIHRpbWUuZ2V0VGltZSgpIDwgRGF0ZS5ub3coKQ0KICAgICAgICB9DQogICAgICB9LA0KICAgICAgdGFibGVEYXRhOiB7DQogICAgICAgIGNhcmRfc246ICcnDQogICAgICB9LA0KICAgIH0NCiAgfSwNCiAgbWV0aG9kczogew0KICAgIC8vIOWPlua2iOW8ueeqlw0KICAgIGhpZGVEaWFsb2coKSB7DQogICAgICB0aGlzLmFkZERjYXJkRGlhbG9nLnNob3cgPSBmYWxzZQ0KICAgICAgdGhpcy4kcmVmc1snYWRkRGNhcmREaWFsb2cnXS5yZXNldEZpZWxkcygpDQogICAgfSwNCiAgICAvLyDmt7vliqDmj5DkuqQNCiAgICBzdWJtaXRBZGQoKSB7DQogICAgICB0aGlzLiRyZWZzWydhZGREY2FyZERpYWxvZyddLnZhbGlkYXRlKGFzeW5jIHZhbGlkID0+IHsNCiAgICAgICAgaWYgKHZhbGlkKSB7DQogICAgICAgICAgYXdhaXQgYWRkRGNhcmQoew0KICAgICAgICAgICAgZGV2aWNlX2lkOiB0aGlzLmRjYXJkTWFuYWdlLmRldmljZV9pZCwNCiAgICAgICAgICAgIGNhcmRfc246IHRoaXMuYWRkRGNhcmREaWFsb2cuZm9ybS5jYXJkX3NuLA0KICAgICAgICAgICAgZW5kX3RpbWU6IG5ldyBEYXRlKHRoaXMuYWRkRGNhcmREaWFsb2cuZm9ybS5lbmRfdGltZSkuZ2V0VGltZSgpLnRvU3RyaW5nKCkuc2xpY2UoMCwgMTApDQogICAgICAgICAgfSkudGhlbigoKSA9PiB7DQogICAgICAgICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MoJ+a3u+WKoOaIkOWKnycpDQogICAgICAgICAgICB0aGlzLmFkZERjYXJkRGlhbG9nLnNob3cgPSBmYWxzZQ0KICAgICAgICAgICAgdGhpcy5zZWFyY2hTdWJtaXQoKQ0KICAgICAgICAgICAgdGhpcy4kcmVmc1snYWRkRGNhcmREaWFsb2cnXS5yZXNldEZpZWxkcygpDQogICAgICAgICAgfSkNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXR1cm4gZmFsc2UNCiAgICAgICAgfQ0KICAgICAgfSkNCiAgICB9LA0KICAgIC8vIOafpeivouaPkOS6pA0KICAgIHNlYXJjaFN1Ym1pdCgpIHsNCiAgICAgIHRoaXMuTWl4X3RhYmxlRGF0YS5jdXJyZW50UGFnZSA9IDENCiAgICAgIHRoaXMuZ2V0RGNhcmRMaXN0KCkNCiAgICB9LA0KICAgIC8vIOa3u+WKoOmXqOWNoQ0KICAgIGFkZERjYXJkKCkgew0KICAgICAgdGhpcy5hZGREY2FyZERpYWxvZy5zaG93ID0gdHJ1ZQ0KICAgIH0sDQogICAgLy8g5Yig6Zmk6Zeo5Y2hDQogICAgZGVsRGNhcmQoY2FyZF9pZCkgew0KICAgICAgdGhpcy4kY29uZmlybSgn5oKo56Gu5a6a6KaB5Yig6Zmk6K+l6Zeo5Y2h5ZCXPycsICfmuKnppqjmj5DnpLonLCB7DQogICAgICAgIHR5cGU6ICd3YXJuaW5nJw0KICAgICAgfSkudGhlbihhc3luYyAoKSA9PiB7DQogICAgICAgIGF3YWl0IGRlbERjYXJkKHsNCiAgICAgICAgICBjYXJkX2lkDQogICAgICAgIH0pLnRoZW4oKCkgPT4gew0KICAgICAgICAgIHRoaXMuJG1lc3NhZ2Uuc3VjY2Vzcygn5Yig6Zmk5oiQ5YqfJykNCiAgICAgICAgICB0aGlzLk1peF90YWJsZURhdGEuY3VycmVudFBhZ2UgPSAxDQogICAgICAgICAgdGhpcy5nZXREY2FyZExpc3QoKQ0KICAgICAgICB9KQ0KICAgICAgfSkuY2F0Y2goKCkgPT4ge30pDQogICAgfSwNCiAgICAvLyDov5Tlm57kuIrkuIDpobUNCiAgICBiYWNrKCkgew0KICAgICAgdGhpcy4kZW1pdCgnYmFjaycsICdkZXZpY2UnKQ0KICAgIH0sDQogICAgLy8g6I635Y+W6Zeo5Y2h5YiX6KGoDQogICAgYXN5bmMgZ2V0RGNhcmRMaXN0KCkgew0KICAgICAgYXdhaXQgZ2V0RGNhcmRMaXN0KHsNCiAgICAgICAgcGFnZTogdGhpcy5NaXhfdGFibGVEYXRhLmN1cnJlbnRQYWdlLA0KICAgICAgICBsaW1pdDogdGhpcy5NaXhfdGFibGVEYXRhLnBhZ2VTaXplLA0KICAgICAgICBkZXZpY2VfaWQ6IHRoaXMuZGNhcmRNYW5hZ2UuZGV2aWNlX2lkLA0KICAgICAgICBjYXJkX3NuOiB0aGlzLnRhYmxlRGF0YS5jYXJkX3NuDQogICAgICB9KS50aGVuKGRhdGEgPT4gew0KICAgICAgICB0aGlzLk1peF90YWJsZURhdGEubGlzdCA9IGRhdGEubGlzdA0KICAgICAgICB0aGlzLk1peF90YWJsZURhdGEudG90YWwgPSBkYXRhLmNvdW50DQogICAgICB9KQ0KICAgIH0NCiAgfSwNCiAgbW91bnRlZCgpIHsNCiAgICB0aGlzLmdldERjYXJkTGlzdCgpDQogIH0NCn0NCg=="},{"version":3,"sources":["dcard-manage-index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsDA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"dcard-manage-index.vue","sourceRoot":"src/views/store-manage/dcard-manage","sourcesContent":["<template>\r\n  <div class=\"dcard-manage-index\">\r\n    <el-button icon=\"el-icon-back\" @click=\"back\">返回设备列表</el-button>\r\n    <el-button icon=\"el-icon-circle-plus-outline\" type=\"primary\" @click=\"addDcard\">添加门卡</el-button>\r\n    <el-button :disabled=\"!Mix_tableData.selectionIds.length\" icon=\"el-icon-delete\" type=\"danger\"\r\n               @click=\"delDcard(Mix_tableData.selectionIds)\">批量删除\r\n    </el-button>\r\n    <el-input v-model=\"tableData.card_sn\" clearable maxlength=\"30\" placeholder=\"门卡序列号\"\r\n              style=\"width:250px\" @keypress.native.enter=\"searchSubmit\" @clear=\"searchSubmit\"></el-input>\r\n    <el-button icon=\"el-icon-search\" type=\"primary\" @click=\"searchSubmit\">查询</el-button>\r\n    <el-tag type=\"primary\">{{ `当前位置：${storeManage.store_name}，${roomManage.room_name}，${ dcardManage.device_name }` }}</el-tag>\r\n    <el-table ref=\"table\" :data=\"Mix_tableData.list\" border class=\"mt15\" height=\"calc(100vh - 225px)\"\r\n              @selection-change=\"$selectionChange($event, 'card_id')\">\r\n      <el-table-column type=\"selection\" width=\"50\"></el-table-column>\r\n      <el-table-column align=\"center\" label=\"ID\" prop=\"card_id\" width=\"80\"></el-table-column>\r\n      <el-table-column label=\"门卡序列号\" prop=\"card_sn\"></el-table-column>\r\n      <el-table-column label=\"过期时间\">\r\n        <template slot-scope=\"scope\">\r\n          {{ $dateFormatter(scope.row.end_time + '000', 'yy-mm-dd hh:mm:ss') }}\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column align=\"center\" label=\"操作\" type=\"action\">\r\n        <template slot-scope=\"scope\">\r\n          <el-button size=\"mini\" type=\"danger\" icon=\"el-icon-delete\" @click=\"delDcard([scope.row.card_id])\">删除</el-button>\r\n        </template>\r\n      </el-table-column>\r\n    </el-table>\r\n    <Pagination :tableData=\"Mix_tableData\" @pageChange=\"$pageChange\" :getList=\"getDcardList\"></Pagination>\r\n    <el-dialog\r\n      title=\"添加门卡\"\r\n      :visible.sync=\"addDcardDialog.show\"\r\n      width=\"30%\">\r\n      <el-form ref=\"addDcardDialog\" :model=\"addDcardDialog.form\" :rules=\"addDcardDialog.formRules\" label-width=\"100px\">\r\n        <el-form-item label=\"门卡序列号\" prop=\"card_sn\">\r\n          <el-input placeholder=\"请输入门卡序列号\" v-model.trim=\"addDcardDialog.form.card_sn\" maxlength=\"50\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"结束时间\" prop=\"end_time\">\r\n          <el-date-picker\r\n            v-model=\"addDcardDialog.form.end_time\"\r\n            type=\"datetime\"\r\n            :picker-options=\"pickerOptions\"\r\n            placeholder=\"选择过期时间\">\r\n          </el-date-picker>\r\n        </el-form-item>\r\n      </el-form>\r\n      <span slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button @click=\"hideDialog\">取消</el-button>\r\n        <el-button type=\"primary\" @click=\"submitAdd\">确定</el-button>\r\n      </span>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {mapState} from \"vuex\"\r\nimport {getDcardList, addDcard, delDcard} from \"@/api/store-manage/dcard-manage\"\r\n\r\nexport default {\r\n  name: \"dcard-manage-index\",\r\n  computed: {\r\n    ...mapState({\r\n      storeManage: state => state['store-manage/store-manage'].storeManage,\r\n      roomManage: state => state['store-manage/room-manage'].roomManage,\r\n      dcardManage: state => state['store-manage/dcard-manage'].dcardManage\r\n    })\r\n  },\r\n  data() {\r\n    return {\r\n      addDcardDialog: {\r\n        show: false,\r\n        form: {\r\n          card_sn: '',\r\n          end_time: ''\r\n        },\r\n        formRules: {\r\n          card_sn: [{\r\n            required: true,\r\n            message: '请输入门卡序列号'\r\n          }],\r\n          end_time: [{\r\n            required: true,\r\n            message: '请选择门卡过期时间'\r\n          }]\r\n        }\r\n      },\r\n      pickerOptions: {\r\n        disabledDate(time) {\r\n          return time.getTime() < Date.now()\r\n        }\r\n      },\r\n      tableData: {\r\n        card_sn: ''\r\n      },\r\n    }\r\n  },\r\n  methods: {\r\n    // 取消弹窗\r\n    hideDialog() {\r\n      this.addDcardDialog.show = false\r\n      this.$refs['addDcardDialog'].resetFields()\r\n    },\r\n    // 添加提交\r\n    submitAdd() {\r\n      this.$refs['addDcardDialog'].validate(async valid => {\r\n        if (valid) {\r\n          await addDcard({\r\n            device_id: this.dcardManage.device_id,\r\n            card_sn: this.addDcardDialog.form.card_sn,\r\n            end_time: new Date(this.addDcardDialog.form.end_time).getTime().toString().slice(0, 10)\r\n          }).then(() => {\r\n            this.$message.success('添加成功')\r\n            this.addDcardDialog.show = false\r\n            this.searchSubmit()\r\n            this.$refs['addDcardDialog'].resetFields()\r\n          })\r\n        } else {\r\n          return false\r\n        }\r\n      })\r\n    },\r\n    // 查询提交\r\n    searchSubmit() {\r\n      this.Mix_tableData.currentPage = 1\r\n      this.getDcardList()\r\n    },\r\n    // 添加门卡\r\n    addDcard() {\r\n      this.addDcardDialog.show = true\r\n    },\r\n    // 删除门卡\r\n    delDcard(card_id) {\r\n      this.$confirm('您确定要删除该门卡吗?', '温馨提示', {\r\n        type: 'warning'\r\n      }).then(async () => {\r\n        await delDcard({\r\n          card_id\r\n        }).then(() => {\r\n          this.$message.success('删除成功')\r\n          this.Mix_tableData.currentPage = 1\r\n          this.getDcardList()\r\n        })\r\n      }).catch(() => {})\r\n    },\r\n    // 返回上一页\r\n    back() {\r\n      this.$emit('back', 'device')\r\n    },\r\n    // 获取门卡列表\r\n    async getDcardList() {\r\n      await getDcardList({\r\n        page: this.Mix_tableData.currentPage,\r\n        limit: this.Mix_tableData.pageSize,\r\n        device_id: this.dcardManage.device_id,\r\n        card_sn: this.tableData.card_sn\r\n      }).then(data => {\r\n        this.Mix_tableData.list = data.list\r\n        this.Mix_tableData.total = data.count\r\n      })\r\n    }\r\n  },\r\n  mounted() {\r\n    this.getDcardList()\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n\r\n</style>\r\n"]}]}
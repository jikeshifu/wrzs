{"remainingRequest":"D:\\coding\\wrzs\\wrzs_storemanagement\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\coding\\wrzs\\wrzs_storemanagement\\src\\views\\store-manage\\room-manage\\room-manage-index.vue?vue&type=style&index=0&id=b5eb2d00&scoped=true&lang=scss&","dependencies":[{"path":"D:\\coding\\wrzs\\wrzs_storemanagement\\src\\views\\store-manage\\room-manage\\room-manage-index.vue","mtime":1686935646983},{"path":"D:\\coding\\wrzs\\wrzs_storemanagement\\node_modules\\css-loader\\dist\\cjs.js","mtime":1686936409521},{"path":"D:\\coding\\wrzs\\wrzs_storemanagement\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1686936410614},{"path":"D:\\coding\\wrzs\\wrzs_storemanagement\\node_modules\\postcss-loader\\src\\index.js","mtime":1686936409992},{"path":"D:\\coding\\wrzs\\wrzs_storemanagement\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1686936409160},{"path":"D:\\coding\\wrzs\\wrzs_storemanagement\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1686936409160},{"path":"D:\\coding\\wrzs\\wrzs_storemanagement\\node_modules\\vue-loader\\lib\\index.js","mtime":1686936410308}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoud2Vlay10YWcgewogICYrLndlZWstdGFnIHsKICAgIG1hcmdpbi1sZWZ0OiAxMHB4OwogIH0KfQoKLmVsLWRyb3Bkb3duLWxpbmsgewogIGN1cnNvcjogcG9pbnRlcjsKICBjb2xvcjogIzQwOUVGRjsKfQoKLmxpZ2h0LWZvcm0gewogIC5lbC1mb3JtLWl0ZW0gewogICAgbWFyZ2luLWJvdHRvbTogMDsKICB9Cn0K"},{"version":3,"sources":["room-manage-index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkVA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"room-manage-index.vue","sourceRoot":"src/views/store-manage/room-manage","sourcesContent":["<template>\r\n  <div class=\"room-manage-index\">\r\n    <el-button @click=\"back\" icon=\"el-icon-back\">返回门店列表</el-button>\r\n    <el-button type=\"primary\" icon=\"el-icon-circle-plus-outline\" @click=\"addRoom\">添加房间</el-button>\r\n    <el-button type=\"warning\" icon=\"el-icon-edit\" :disabled=\"Mix_tableData.selectionIds.length !== 1\"\r\n      @click=\"editRoom(Mix_tableData.selectionObj[0])\">编辑\r\n    </el-button>\r\n    <el-button type=\"danger\" icon=\"el-icon-delete\" :disabled=\"!Mix_tableData.selectionIds.length\"\r\n      @click=\"delRoom(Mix_tableData.selectionIds)\">批量删除\r\n    </el-button>\r\n    <el-input style=\"width:200px\" placeholder=\"房间名称\" v-model=\"tableData.public\" maxlength=\"30\" clearable></el-input>\r\n    <el-select v-model=\"tableData.status\" placeholder=\"请选择状态\" clearable>\r\n      <el-option label=\"正常\" :value=\"1\"></el-option>\r\n      <el-option label=\"停用\" :value=\"0\"></el-option>\r\n    </el-select>\r\n    <el-button type=\"primary\" icon=\"el-icon-search\" @click=\"searchSubmit\">查询</el-button>\r\n    <el-button type=\"primary\" icon=\"el-icon-refresh-right\" @click=\"resetData\">重置</el-button>\r\n    <el-tag type=\"primary\">当前门店名称：{{ storeManage.store_name }}</el-tag>\r\n    <el-table ref=\"table\" class=\"mt15\" border height=\"calc(100vh - 225px)\" :data=\"Mix_tableData.list\"\r\n      @selection-change=\"$selectionChange($event, 'room_id')\">\r\n      <el-table-column type=\"selection\" width=\"50\"></el-table-column>\r\n      <el-table-column label=\"房间名称\" prop=\"room_name\"></el-table-column>\r\n      <el-table-column label=\"房间标签\" align=\"center\">\r\n        <template slot-scope=\"scope\">\r\n          <el-tag>{{ scope.row.room_label }}</el-tag>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"房间主图\" width=\"100\">\r\n        <template slot-scope=\"scope\">\r\n          <el-image style=\"width:100%;height:100px;\" :src=\"baseUrl + scope.row.room_image\" fit=\"cover\" alt=\"\"\r\n            :preview-src-list=\"[baseUrl + scope.row.room_image]\"></el-image>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"押金\" align=\"center\">\r\n        <template slot-scope=\"scope\">\r\n          {{ scope.row.room_deposit }}元\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"排序(大到小)\" width=\"120\">\r\n        <template slot-scope=\"scope\">\r\n          <el-input @blur=\"changeSort(scope.row)\" v-model=\"scope.row.sort\" maxlength=\"5\"\r\n            @input=\"scope.row.sort = Number(scope.row.sort.replace(/[^\\d]/g,''))\"></el-input>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"可容纳人数\" align=\"center\">\r\n        <template slot-scope=\"scope\">\r\n          {{ scope.row.room_people }}人\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"房间单价\" align=\"center\">\r\n        <template slot-scope=\"scope\">\r\n          {{ scope.row.room_price }}元\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"电源情况\" align=\"center\">\r\n        <template slot-scope=\"scope\">\r\n          <el-popover placement=\"top-start\" trigger=\"hover\">\r\n            <el-form class=\"light-form\" label-width=\"80px\">\r\n              <el-form-item label=\"自动通电\">\r\n                <el-switch v-model=\"scope.row.electric_status\" :active-value=\"1\" :inactive-value=\"0\"\r\n                  @change=\"changeOnStatus(scope.row)\">\r\n                </el-switch>\r\n              </el-form-item>\r\n              <el-form-item label=\"自动关电\">\r\n                <el-switch v-model=\"scope.row.electric_stop_status\" :active-value=\"1\" :inactive-value=\"0\"\r\n                  @change=\"changeOffStatus(scope.row)\">\r\n                </el-switch>\r\n              </el-form-item>\r\n            </el-form>\r\n            <el-button type=\"text\" slot=\"reference\">查看</el-button>\r\n          </el-popover>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"起订时长\" align=\"center\">\r\n        <template slot-scope=\"scope\">\r\n          {{ scope.row.starting_time }}\r\n          <template v-if=\"scope.row.room_type === 1\">小时</template>\r\n          <template v-if=\"scope.row.room_type === 2\">天</template>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"预定类型\" align=\"center\">\r\n        <template slot-scope=\"scope\">\r\n          <el-tag type=\"primary\" v-if=\"scope.row.room_type === 1\">按小时</el-tag>\r\n          <el-tag type=\"success\" v-if=\"scope.row.room_type === 2\">按天数</el-tag>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"状态\" align=\"center\">\r\n        <template slot-scope=\"scope\">\r\n          <el-switch v-model=\"scope.row.status\" :active-value=\"1\" :inactive-value=\"0\" @change=\"changeStatus(scope.row)\">\r\n          </el-switch>\r\n        </template>\r\n      </el-table-column>\r\n      <!-- <el-table-column label=\"用户可取消\" width=\"100\" align=\"center\">\r\n        <template slot-scope=\"scope\">\r\n          <el-switch v-model=\"scope.row.cancel_status\" :active-value=\"1\" :inactive-value=\"0\"\r\n            @change=\"changeCancelStatus(scope.row)\">\r\n          </el-switch>\r\n        </template>\r\n      </el-table-column> -->\r\n      <!-- <el-table-column label=\"可否结算\" width=\"100\" align=\"center\">\r\n        <template slot-scope=\"scope\">\r\n          <el-switch v-model=\"scope.row.settlement_status\" :active-value=\"1\" :inactive-value=\"0\"\r\n            @change=\"changeSettlStatus(scope.row)\">\r\n          </el-switch>\r\n        </template>\r\n      </el-table-column> -->\r\n      <!-- <el-table-column label=\"工作时间\" align=\"center\">\r\n        <template slot-scope=\"scope\">\r\n          <el-popover placement=\"top-end\" title=\"工作日-营业时间\" trigger=\"hover\">\r\n            <el-tag class=\"week-tag\" v-for=\"item in scope.row.work_week\" :key=\"item\" type=\"primary\">\r\n              {{ item | numTransZh_Week }}\r\n            </el-tag>\r\n            <div class=\"mt15\">\r\n              <el-tag type=\"danger\">{{ scope.row.work_time_start + ' ~ ' + scope.row.work_time_end }}</el-tag>\r\n            </div>\r\n            <el-button type=\"text\" slot=\"reference\">查看</el-button>\r\n          </el-popover>\r\n        </template>\r\n      </el-table-column> -->\r\n      <el-table-column label=\"房间面积\" align=\"center\">\r\n        <template slot-scope=\"scope\">\r\n          {{ scope.row.room_size }}平方米\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"已售\" align=\"center\" prop=\"room_sold\"></el-table-column>\r\n      <el-table-column label=\"操作\" type=\"action\" align=\"center\">\r\n        <template slot-scope=\"scope\">\r\n          <el-dropdown>\r\n            <span class=\"el-dropdown-link\">\r\n              操作<i class=\"el-icon-arrow-down el-icon--right\"></i>\r\n            </span>\r\n            <el-dropdown-menu slot=\"dropdown\">\r\n              <!-- <el-dropdown-item>\r\n                <el-button type=\"text\" size=\"mini\" icon=\"kj kj-service\" @click=\"service(scope.row)\">房间服务\r\n                </el-button>\r\n              </el-dropdown-item> -->\r\n              <el-dropdown-item>\r\n                <el-button type=\"text\" size=\"mini\" icon=\"el-icon-document-copy\" @click=\"copyRoom(scope.row.room_id)\">\r\n                  复制房间</el-button>\r\n              </el-dropdown-item>\r\n              <el-dropdown-item>\r\n                <el-button type=\"text\" size=\"mini\" icon=\"el-icon-set-up\" @click=\"pageToDevice(scope.row)\">设备管理\r\n                </el-button>\r\n              </el-dropdown-item>\r\n              <!-- <el-dropdown-item>\r\n                <el-button type=\"text\" size=\"mini\" icon=\"kj kj-money\" @click=\"manJian(scope.row)\">满减管理\r\n                </el-button>\r\n              </el-dropdown-item> -->\r\n              <el-dropdown-item>\r\n                <el-button type=\"text\" size=\"mini\" icon=\"el-icon-edit\" @click=\"editRoom(scope.row)\">编辑</el-button>\r\n              </el-dropdown-item>\r\n              <el-dropdown-item>\r\n                <el-button type=\"text\" size=\"mini\" icon=\"el-icon-delete\" @click=\"delRoom([scope.row.room_id])\">删除\r\n                </el-button>\r\n              </el-dropdown-item>\r\n            </el-dropdown-menu>\r\n          </el-dropdown>\r\n        </template>\r\n      </el-table-column>\r\n    </el-table>\r\n    <Pagination :tableData=\"Mix_tableData\" @pageChange=\"$pageChange\" :getList=\"getRoomList\"></Pagination>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n  import {\r\n    mapState\r\n  } from \"vuex\"\r\n  import {\r\n    getRoomList,\r\n    editRoomStatus,\r\n    editRoomSort,\r\n    editRoomOnStatus,\r\n    editRoomOffStatus,\r\n    editRoomSettlStatus,\r\n    delRoom,\r\n    copyRoom,\r\n    editRoomCancelStatus\r\n  } from \"@/api/store-manage/room-manage\"\r\n\r\n  export default {\r\n    name: \"room-manage-index\",\r\n    computed: {\r\n      ...mapState({\r\n        storeManage: state => state['store-manage/store-manage'].storeManage\r\n      })\r\n    },\r\n    data() {\r\n      return {\r\n        tableData: {\r\n          public: '',\r\n          status: ''\r\n        }\r\n      }\r\n    },\r\n    methods: {\r\n      // 自动通电\r\n      async changeOnStatus(row) {\r\n        await editRoomOnStatus({\r\n          room_id: row.room_id,\r\n          status: row.electric_status\r\n        }).then(() => {\r\n          this.$message.success('修改成功')\r\n          this.getRoomList()\r\n        })\r\n      },\r\n      // 自动关电\r\n      async changeOffStatus(row) {\r\n        await editRoomOffStatus({\r\n          room_id: row.room_id,\r\n          status: row.electric_stop_status\r\n        }).then(() => {\r\n          this.$message.success('修改成功')\r\n          this.getRoomList()\r\n        })\r\n      },\r\n      // 返回上一页\r\n      back() {\r\n        this.$emit('back', 'index')\r\n      },\r\n      // 复制房间\r\n      async copyRoom(room_id) {\r\n        await copyRoom({\r\n          room_id\r\n        })\r\n        this.$message.success('复制成功')\r\n        await this.getRoomList()\r\n      },\r\n      // 获取房间列表\r\n      async getRoomList() {\r\n        this.$refs.table.clearFilter()\r\n        await getRoomList({\r\n          page: this.Mix_tableData.currentPage,\r\n          limit: this.Mix_tableData.pageSize,\r\n          status: this.tableData.status,\r\n          public: this.tableData.public,\r\n          store_id: this.storeManage.store_id\r\n        }).then(data => {\r\n          this.Mix_tableData.list = data.list\r\n          this.Mix_tableData.total = data.count\r\n        })\r\n      },\r\n      // 房间排序\r\n      async changeSort(rows) {\r\n        await editRoomSort({\r\n          room_id: rows.room_id,\r\n          sort: rows.sort\r\n        }).then(() => {\r\n          this.$message.success('修改成功')\r\n          this.getRoomList()\r\n        })\r\n      },\r\n      // 查询\r\n      searchSubmit() {\r\n        this.Mix_tableData.currentPage = 1\r\n        this.getRoomList()\r\n      },\r\n      // 结算功能改变事件\r\n      async changeSettlStatus(row) {\r\n        await editRoomSettlStatus({\r\n          room_id: row.room_id,\r\n          settlement_status: row.settlement_status\r\n        }).then(() => {\r\n          this.$message.success('修改成功')\r\n          this.getRoomList()\r\n        })\r\n      },\r\n      // 用户可否取消该房间\r\n      async changeCancelStatus(row) {\r\n        await editRoomCancelStatus({\r\n          room_id: row.room_id,\r\n          cancel_status: row.cancel_status\r\n        }).then(() => {\r\n          this.$message.success('修改成功')\r\n          this.getRoomList()\r\n        })\r\n      },\r\n      // 改变房间状态\r\n      async changeStatus(row) {\r\n        await editRoomStatus({\r\n          room_id: row.room_id,\r\n          status: row.status\r\n        }).then(() => {\r\n          this.$message.success('修改成功')\r\n          this.getRoomList()\r\n        })\r\n      },\r\n      // 重置数据\r\n      resetData() {\r\n        this.tableData.status = ''\r\n        this.tableData.public = ''\r\n      },\r\n      // 添加房间\r\n      addRoom() {\r\n        this.$emit('componentsChange', 'add')\r\n      },\r\n      // 跳转到设备管理\r\n      async pageToDevice(data) {\r\n        await this.$store.dispatch('store-manage/room-manage/setRoomData', data)\r\n        this.$emit('back', 'device')\r\n      },\r\n      // 房间服务\r\n      async service(data) {\r\n        await this.$store.dispatch('store-manage/room-manage/setRoomData', data)\r\n        this.$emit('back', 'service')\r\n      },\r\n      // 满减管理\r\n      async manJian(data) {\r\n        await this.$store.dispatch('store-manage/room-manage/setRoomData', data)\r\n        this.$emit('back', 'manJian')\r\n      },\r\n      // 编辑房间\r\n      async editRoom(data) {\r\n        await this.$store.dispatch('store-manage/room-manage/setRoomData', data)\r\n        this.$emit('componentsChange', 'edit')\r\n      },\r\n      // 删除房间\r\n      delRoom(room_id) {\r\n        this.$confirm('删除后，该房间所有设备、售货等信息都将清空，您确定要删除该房间吗?', '温馨提示', {\r\n          type: 'warning'\r\n        }).then(async () => {\r\n          await delRoom({\r\n            room_id\r\n          }).then(() => {\r\n            this.$message.success('删除成功')\r\n            this.Mix_tableData.currentPage = 1\r\n            this.getRoomList()\r\n          })\r\n        }).catch(() => {})\r\n      }\r\n    },\r\n    mounted() {\r\n      this.getRoomList()\r\n    }\r\n  }\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n  .week-tag {\r\n    &+.week-tag {\r\n      margin-left: 10px;\r\n    }\r\n  }\r\n\r\n  .el-dropdown-link {\r\n    cursor: pointer;\r\n    color: #409EFF;\r\n  }\r\n\r\n  .light-form {\r\n    .el-form-item {\r\n      margin-bottom: 0;\r\n    }\r\n  }\r\n</style>\r\n"]}]}
{"remainingRequest":"D:\\coding\\wrzs\\wrzs_storemanagement\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\coding\\wrzs\\wrzs_storemanagement\\src\\views\\store-manage\\device-manage\\device-manage-index.vue?vue&type=style&index=0&id=cf717eec&lang=scss&scoped=true&","dependencies":[{"path":"D:\\coding\\wrzs\\wrzs_storemanagement\\src\\views\\store-manage\\device-manage\\device-manage-index.vue","mtime":1689090525755},{"path":"D:\\coding\\wrzs\\wrzs_storemanagement\\node_modules\\css-loader\\dist\\cjs.js","mtime":1686936409521},{"path":"D:\\coding\\wrzs\\wrzs_storemanagement\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1686936410614},{"path":"D:\\coding\\wrzs\\wrzs_storemanagement\\node_modules\\postcss-loader\\src\\index.js","mtime":1686936409992},{"path":"D:\\coding\\wrzs\\wrzs_storemanagement\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1686936409160},{"path":"D:\\coding\\wrzs\\wrzs_storemanagement\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1686936409160},{"path":"D:\\coding\\wrzs\\wrzs_storemanagement\\node_modules\\vue-loader\\lib\\index.js","mtime":1686936410308}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgouZWwtZHJvcGRvd24tbGluayB7CiAgY3Vyc29yOiBwb2ludGVyOwogIGNvbG9yOiAjNDA5RUZGOwp9Cg=="},{"version":3,"sources":["device-manage-index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+OA;AACA;AACA;AACA","file":"device-manage-index.vue","sourceRoot":"src/views/store-manage/device-manage","sourcesContent":["<template>\r\n  <div class=\"device-manage-index\">\r\n    <el-button icon=\"el-icon-back\" @click=\"back\">返回房间列表</el-button>\r\n    <el-button icon=\"el-icon-circle-plus-outline\" type=\"primary\" @click=\"addDevice\">添加设备</el-button>\r\n    <el-button :disabled=\"!Mix_tableData.selectionIds.length\" icon=\"el-icon-delete\" type=\"danger\"\r\n      @click=\"delDevice(Mix_tableData.selectionIds)\">批量删除\r\n    </el-button>\r\n    <el-input v-model=\"tableData.public\" clearable maxlength=\"30\" placeholder=\"设备名称/序列号/网关SN\" style=\"width:250px\">\r\n    </el-input>\r\n    <el-select v-model=\"tableData.device_type\" clearable placeholder=\"请选择设备类型\">\r\n      <el-option label=\"门锁\" value=\"1\"></el-option>\r\n      <el-option label=\"大门\" value=\"2\"></el-option>\r\n      <el-option label=\"空开\" value=\"3\"></el-option>\r\n    </el-select>\r\n    <el-button icon=\"el-icon-search\" type=\"primary\" @click=\"searchSubmit\">查询</el-button>\r\n    <el-button icon=\"el-icon-refresh-right\" type=\"primary\" @click=\"resetData\">重置</el-button>\r\n    <el-tag type=\"primary\">{{ `当前位置：${storeManage.store_name}，${roomManage.room_name}` }}</el-tag>\r\n    <el-table ref=\"table\" :data=\"Mix_tableData.list\" border class=\"mt15\" height=\"calc(100vh - 225px)\"\r\n      @selection-change=\"$selectionChange($event, 'device_id')\">\r\n      <el-table-column type=\"selection\" width=\"50\"></el-table-column>\r\n      <el-table-column align=\"center\" label=\"ID\" prop=\"device_id\" width=\"80\"></el-table-column>\r\n      <el-table-column label=\"设备名称\" prop=\"device_name\"></el-table-column>\r\n      <el-table-column label=\"设备类型\">\r\n        <template slot-scope=\"scope\">\r\n          <el-tag type=\"primary\">{{ scope.row.device_type | numTransZh_deviceType }}</el-tag>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"设备序列号\" prop=\"device_sn\"></el-table-column>\r\n      <el-table-column label=\"二维码\" prop=\"qr_img\" align=\"center\">\r\n        <template slot-scope=\"scope\">\r\n          <el-image :preview-src-list=\"[baseUrl + scope.row.qr_img]\" style=\"width:100px;height:100px\"\r\n            :src=\"baseUrl + scope.row.qr_img\" fit=\"cover\"></el-image>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"网关SN\" prop=\"gw_sn\"></el-table-column>\r\n      <el-table-column :filter-method=\"filterOnline\" :filters=\"[{ text: '在线', value: 1 }, { text: '离线', value: 0 }]\"\r\n        filter-placement=\"bottom-end\" label=\"状态\" prop=\"on_line\">\r\n        <template slot-scope=\"scope\">\r\n          <el-tag v-if=\"scope.row.on_line === 1\" type=\"primary\">在线</el-tag>\r\n          <el-tag v-if=\"scope.row.on_line === 0\" type=\"danger\">离线</el-tag>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"语音文本\" prop=\"voice\"></el-table-column>\r\n      <el-table-column label=\"语音音量\" prop=\"volume\"></el-table-column>\r\n      <el-table-column label=\"设备二维码\">\r\n        <el-table-column label=\"自动更新\" prop=\"qr_status\">\r\n          <template slot-scope=\"scope\">\r\n            <el-row align=\"middle\" justify=\"space-between\" type=\"flex\">\r\n              <el-col>\r\n                <el-switch :active-value=\"1\" :inactive-value=\"0\" :value=\"scope.row.qr_status\"></el-switch>\r\n              </el-col>\r\n              <el-col>\r\n                <el-button icon=\"el-icon-edit\" size=\"mini\" type=\"text\" @click=\"editDeviceEwm(scope.row)\">编辑</el-button>\r\n              </el-col>\r\n            </el-row>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column label=\"开始更新时间\" prop=\"qr_time\"></el-table-column>\r\n      </el-table-column>\r\n      <el-table-column align=\"center\" label=\"操作\" type=\"action\">\r\n        <template slot-scope=\"scope\">\r\n          <el-dropdown>\r\n            <span class=\"el-dropdown-link\">\r\n              操作<i class=\"el-icon-arrow-down el-icon--right\"></i>\r\n            </span>\r\n            <el-dropdown-menu slot=\"dropdown\">\r\n              <el-dropdown-item v-if=\"scope.row.device_type !== 4\">\r\n                <el-button icon=\"el-icon-bank-card\" size=\"mini\" type=\"primary\" @click=\"dcardManage(scope.row)\">门卡管理\r\n                </el-button>\r\n              </el-dropdown-item>\r\n              <el-dropdown-item>\r\n                <el-button icon=\"el-icon-edit\" size=\"mini\" type=\"warning\" @click=\"editDevice(scope.row)\">编辑\r\n                </el-button>\r\n              </el-dropdown-item>\r\n              <el-dropdown-item>\r\n                <el-button icon=\"el-icon-delete\" size=\"mini\" type=\"danger\" @click=\"delDevice([scope.row.device_id])\">删除\r\n                </el-button>\r\n              </el-dropdown-item>\r\n            </el-dropdown-menu>\r\n          </el-dropdown>\r\n        </template>\r\n      </el-table-column>\r\n    </el-table>\r\n    <Pagination :tableData=\"Mix_tableData\" @pageChange=\"$pageChange\" :getList=\"getDeviceList\"></Pagination>\r\n    <el-dialog :visible.sync=\"ewmDialog.show\" title=\"设备二维码设置\" width=\"30%\">\r\n      <el-form ref=\"ewmDialog\" :model=\"ewmDialog.data\" :rules=\"ewmDialog.rules\" label-position=\"left\"\r\n        label-width=\"80px\">\r\n        <el-form-item label=\"设备名称\">{{ ewmDialog.data.device_name }}</el-form-item>\r\n        <el-form-item label=\"序列号\">{{ ewmDialog.data.device_sn }}</el-form-item>\r\n        <el-form-item label=\"设备类型\">\r\n          <el-tag type=\"primary\">{{ ewmDialog.data.device_type | numTransZh_deviceType }}</el-tag>\r\n        </el-form-item>\r\n        <el-form-item label=\"自动更新\">\r\n          <el-switch v-model=\"ewmDialog.data.qr_status\" :active-value=\"1\" :inactive-value=\"0\"></el-switch>\r\n        </el-form-item>\r\n        <el-form-item v-if=\"ewmDialog.data.qr_status\" label=\"更新时间\" prop=\"qr_time\">\r\n          <el-time-select v-model=\"ewmDialog.data.qr_time\" :picker-options=\"{\r\n    start: '00:00',\r\n    step: '01:00',\r\n    end: '24:00'\r\n  }\" placeholder=\"选择更新时间\">\r\n          </el-time-select>\r\n        </el-form-item>\r\n      </el-form>\r\n      <span slot=\"footer\">\r\n        <el-button @click=\"ewmDialog.show = false\">取消</el-button>\r\n        <el-button type=\"primary\"\r\n          @click=\"submitEwmSet\">确定</el-button>\r\n      </span>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n  import {\r\n    mapState\r\n  } from \"vuex\"\r\n  import {\r\n    getDeviceList,\r\n    delDevice,\r\n    editDeviceEwm\r\n  } from \"@/api/store-manage/device-manage\"\r\n\r\n  export default {\r\n    name: \"device-manage-index\",\r\n    computed: {\r\n      ...mapState({\r\n        storeManage: state => state['store-manage/store-manage'].storeManage,\r\n        roomManage: state => state['store-manage/room-manage'].roomManage\r\n      })\r\n    },\r\n    data() {\r\n      return {\r\n        tableData: {\r\n          public: '',\r\n          device_type: ''\r\n        },\r\n        // 二维码弹窗\r\n        ewmDialog: {\r\n          show: false,\r\n          data: {},\r\n          rules: {\r\n            qr_time: [{\r\n              required: true,\r\n              message: '请选择更新时间'\r\n            }]\r\n          }\r\n        }\r\n      }\r\n    },\r\n    methods: {\r\n      // 门卡管理\r\n      async dcardManage(data) {\r\n        await this.$store.dispatch('store-manage/dcard-manage/setDcardManageData', data)\r\n        this.$emit('back', 'dcard')\r\n      },\r\n      // 提交二维码设置\r\n      submitEwmSet() {\r\n        this.$refs['ewmDialog'].validate(async valid => {\r\n          if (valid) {\r\n            await editDeviceEwm(this.ewmDialog.data).then(() => {\r\n              this.$message.success('修改成功')\r\n              this.ewmDialog.show = false\r\n              this.Mix_tableData.currentPage = 1\r\n              this.getDeviceList()\r\n            })\r\n          } else {\r\n            return false\r\n          }\r\n        })\r\n      },\r\n      // 编辑设备二维码\r\n      editDeviceEwm(e) {\r\n        this.ewmDialog.data = JSON.parse(JSON.stringify(e))\r\n        this.ewmDialog.show = true\r\n      },\r\n      // 编辑设备信息\r\n      async editDevice(data) {\r\n        await this.$store.dispatch('store-manage/device-manage/setDeviceManageData', data)\r\n        this.$emit('componentsChange', 'edit')\r\n      },\r\n      // 返回上一页\r\n      back() {\r\n        this.$emit('back', 'room')\r\n      },\r\n      // 获取设备列表\r\n      async getDeviceList() {\r\n        this.$refs.table.clearFilter()\r\n        await getDeviceList({\r\n          page: this.Mix_tableData.currentPage,\r\n          limit: this.Mix_tableData.pageSize,\r\n          public: this.tableData.public,\r\n          room_id: this.roomManage.room_id,\r\n          device_type: this.tableData.device_type\r\n        }).then(data => {\r\n          this.Mix_tableData.list = data.list\r\n          this.Mix_tableData.total = data.count\r\n        })\r\n      },\r\n      // 筛选在线/离线\r\n      filterOnline(value, row) {\r\n        return row.on_line === value\r\n      },\r\n      // 添加设备\r\n      addDevice() {\r\n        this.$emit('componentsChange', 'add')\r\n      },\r\n      // 删除设备\r\n      delDevice(device_id) {\r\n        this.$confirm('您确定要删除该设备吗?', '温馨提示', {\r\n          type: 'warning'\r\n        }).then(async () => {\r\n          await delDevice({\r\n            device_id\r\n          }).then(() => {\r\n            this.$message.success('删除成功')\r\n            this.Mix_tableData.currentPage = 1\r\n            this.getDeviceList()\r\n          })\r\n        }).catch(() => {})\r\n      },\r\n      // 查询\r\n      searchSubmit() {\r\n        this.Mix_tableData.currentPage = 1\r\n        this.getDeviceList()\r\n      },\r\n      // 重置数据\r\n      resetData() {\r\n        this.tableData.public = ''\r\n        this.tableData.device_type = ''\r\n      }\r\n    },\r\n    mounted() {\r\n      this.getDeviceList()\r\n    }\r\n  }\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n  .el-dropdown-link {\r\n    cursor: pointer;\r\n    color: #409EFF;\r\n  }\r\n</style>\r\n"]}]}
{"code":"(window[\"webpackJsonp\"]=window[\"webpackJsonp\"]||[]).push([[\"chunk-2d0b367c\"],{\"27de\":function(e,t,o){\"use strict\";o.r(t);var n=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o(\"div\",{staticClass:\"coupon-manage\"},[\"index\"===e.type?o(\"Index\",{on:{changeComponents:e.changeComponents}}):e._e()],1)},a=[],i=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o(\"div\",{staticClass:\"coupon-manage-index\"},[o(\"el-button\",{attrs:{type:\"primary\",icon:\"el-icon-plus\"},on:{click:e.addCoupon}},[e._v(\"添加优惠券\")]),o(\"el-button\",{attrs:{type:\"warning\",icon:\"el-icon-edit\",disabled:1!==e.Mix_tableData.selectionObj.length},on:{click:function(t){return e.editCoupon(e.Mix_tableData.selectionObj[0])}}},[e._v(\"编辑\")]),o(\"el-button\",{attrs:{type:\"danger\",icon:\"el-icon-delete\",disabled:!e.Mix_tableData.selectionIds.length},on:{click:function(t){return e.delCoupon(e.Mix_tableData.selectionIds)}}},[e._v(\"批量删除\")]),o(\"el-table\",{ref:\"table\",staticClass:\"mt15\",attrs:{data:e.Mix_tableData.list,border:\"\",height:\"calc(100vh - 225px)\"},on:{\"selection-change\":function(t){return e.$selectionChange(t,\"coupons_id\")}}},[o(\"el-table-column\",{attrs:{type:\"selection\"}}),o(\"el-table-column\",{attrs:{prop:\"coupons_id\",label:\"ID\"}}),o(\"el-table-column\",{attrs:{prop:\"title\",label:\"标题\"}}),o(\"el-table-column\",{attrs:{prop:\"money\",label:\"赠送金额\"}}),o(\"el-table-column\",{attrs:{label:\"赠送新用户\"},scopedSlots:e._u([{key:\"default\",fn:function(t){return[o(\"el-switch\",{attrs:{\"active-value\":1,\"inactive-value\":0},on:{change:function(o){return e.changeNewStatus(t.row)}},model:{value:t.row.new_user_status,callback:function(o){e.$set(t.row,\"new_user_status\",o)},expression:\"scope.row.new_user_status\"}})]}}])}),o(\"el-table-column\",{attrs:{label:\"创建时间\"},scopedSlots:e._u([{key:\"default\",fn:function(t){return[e._v(e._s(e.$dateFormatter(+(t.row.created_at+\"000\"),\"yy-mm-dd hh:mm:ss\")))]}}])}),o(\"el-table-column\",{attrs:{prop:\"day_number\",label:\"有效期(天)\"}}),o(\"el-table-column\",{attrs:{label:\"操作\",width:\"400\",align:\"center\"},scopedSlots:e._u([{key:\"default\",fn:function(t){return[o(\"el-button\",{attrs:{type:\"success\",size:\"mini\",icon:\"el-icon-user-solid\"},on:{click:function(o){return e.sendAllUserCoupon(t.row)}}},[e._v(\"全部赠送\")]),o(\"el-button\",{attrs:{type:\"primary\",size:\"mini\",icon:\"el-icon-user-solid\"},on:{click:function(o){return e.sendCoupon(t.row)}}},[e._v(\"赠送个人\")]),o(\"el-button\",{attrs:{type:\"warning\",size:\"mini\",icon:\"el-icon-edit\"},on:{click:function(o){return e.editCoupon(t.row)}}},[e._v(\"编辑\")]),o(\"el-button\",{attrs:{type:\"danger\",size:\"mini\",icon:\"el-icon-delete\"},on:{click:function(o){return e.delCoupon([t.row.coupons_id])}}},[e._v(\"删除 \")])]}}])})],1),o(\"Pagination\",{attrs:{tableData:e.Mix_tableData,getList:e.getCouponList},on:{pageChange:e.$pageChange}}),o(\"el-dialog\",{attrs:{title:e.dialog.title,\"show-close\":!1,visible:e.dialog.show,width:\"30%\"},on:{\"update:visible\":function(t){return e.$set(e.dialog,\"show\",t)}}},[o(\"el-form\",{ref:\"form\",attrs:{model:e.dialog.form,rules:e.dialog.formRules,\"label-width\":\"120px\"}},[o(\"el-form-item\",{attrs:{prop:\"title\",label:\"优惠券标题\"}},[o(\"el-input\",{attrs:{placeholder:\"请输入套餐标题\",maxlength:\"30\"},model:{value:e.dialog.form.title,callback:function(t){e.$set(e.dialog.form,\"title\",\"string\"===typeof t?t.trim():t)},expression:\"dialog.form.title\"}})],1),o(\"el-form-item\",{attrs:{prop:\"money\",label:\"赠送金额\"}},[o(\"el-input-number\",{attrs:{min:0,max:5e5,precision:0},model:{value:e.dialog.form.money,callback:function(t){e.$set(e.dialog.form,\"money\",t)},expression:\"dialog.form.money\"}})],1),o(\"el-form-item\",{attrs:{prop:\"new_user_status\",label:\"赠送新用户\"}},[o(\"el-radio\",{attrs:{label:0},model:{value:e.dialog.form.new_user_status,callback:function(t){e.$set(e.dialog.form,\"new_user_status\",t)},expression:\"dialog.form.new_user_status\"}},[e._v(\"不赠送\")]),o(\"el-radio\",{attrs:{label:1},model:{value:e.dialog.form.new_user_status,callback:function(t){e.$set(e.dialog.form,\"new_user_status\",t)},expression:\"dialog.form.new_user_status\"}},[e._v(\"赠送\")])],1),o(\"el-form-item\",{attrs:{prop:\"day_number\",label:\"有效期\"}},[o(\"el-input-number\",{attrs:{min:1,max:1e3,precision:0},model:{value:e.dialog.form.day_number,callback:function(t){e.$set(e.dialog.form,\"day_number\",t)},expression:\"dialog.form.day_number\"}}),o(\"el-tag\",[e._v(\"天\")])],1)],1),o(\"span\",{attrs:{slot:\"footer\"},slot:\"footer\"},[o(\"el-button\",{on:{click:e.closeDialog}},[e._v(\"取消\")]),o(\"el-button\",{attrs:{type:\"primary\"},on:{click:e.submit}},[e._v(\"确定\")])],1)],1),o(\"el-dialog\",{attrs:{title:\"赠送优惠券\",visible:e.giveDialog.show,width:\"30%\"},on:{\"update:visible\":function(t){return e.$set(e.giveDialog,\"show\",t)}}},[o(\"el-form\",{ref:\"giveDialog\",attrs:{model:e.giveDialog.form,rules:e.giveDialog.formRules,\"label-width\":\"90px\"}},[o(\"el-form-item\",{attrs:{label:\"用户手机\",prop:\"mobile\"}},[o(\"el-input\",{attrs:{maxlength:\"11\",placeholder:\"请输入要赠送的用户的手机号\"},model:{value:e.giveDialog.form.mobile,callback:function(t){e.$set(e.giveDialog.form,\"mobile\",t)},expression:\"giveDialog.form.mobile\"}})],1)],1),o(\"span\",{attrs:{slot:\"footer\"},slot:\"footer\"},[o(\"el-button\",{on:{click:e.hideGiveDialog}},[e._v(\"取消\")]),o(\"el-button\",{attrs:{type:\"primary\"},on:{click:e.submitGiveDialog}},[e._v(\"确定\")])],1)],1)],1)},s=[],r=o(\"c7eb\"),l=o(\"1da1\"),u=(o(\"ac1f\"),o(\"00b4\"),o(\"b775\"));function c(e){return Object(u[\"a\"])({url:\"/discount.Coupons/list\",method:\"post\",data:e})}function d(e){return Object(u[\"a\"])({url:\"/discount.Coupons/add\",method:\"post\",data:e})}function m(e){return Object(u[\"a\"])({url:\"/discount.Coupons/edit\",method:\"post\",data:e})}function p(e){return Object(u[\"a\"])({url:\"/discount.Coupons/del\",method:\"post\",data:e})}function f(e){return Object(u[\"a\"])({url:\"/discount.Coupons/give\",method:\"post\",data:e})}function g(e){return Object(u[\"a\"])({url:\"/discount.Coupons/gives\",method:\"post\",data:e})}var b={name:\"coupon-manage-index\",data:function(){var e=function(e,t,o){/^1[3456789]\\d{9}$/.test(t)||o(new Error(\"请输入11位正确的手机号\")),o()};return{dialog:{show:!1,title:\"\",form:{coupons_id:\"\",title:\"\",money:\"\",new_user_status:0,day_number:1},formRules:{title:[{required:!0,message:\"请输入优惠券标题\"}],money:[{required:!0,message:\"请输入赠送的金额\"}],day_number:[{required:!0,message:\"请输入有效期限\"}]}},giveDialog:{show:!1,form:{mobile:\"\",coupons_id:\"\"},formRules:{mobile:[{required:!0,message:\"请输入要赠送的用户的手机号\"},{validator:e}]}}}},methods:{hideGiveDialog:function(){this.giveDialog.show=!1,this.$refs[\"giveDialog\"].resetFields()},submitGiveDialog:function(){var e=this;this.$refs[\"giveDialog\"].validate(function(){var t=Object(l[\"a\"])(Object(r[\"a\"])().mark((function t(o){return Object(r[\"a\"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!o){t.next=5;break}return t.next=3,f(e.giveDialog.form).then((function(){e.$message.success(\"赠送成功\"),e.giveDialog.show=!1,e.giveDialog.form.mobile=\"\",e.$refs[\"giveDialog\"].resetFields()}));case 3:t.next=6;break;case 5:return t.abrupt(\"return\",!1);case 6:case\"end\":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},sendAllUserCoupon:function(e){var t=this;this.$confirm(\"您确定要赠送所有用户该卡券吗?\",\"温馨提示\",{cancelButtonText:\"点错了\",type:\"warning\"}).then(Object(l[\"a\"])(Object(r[\"a\"])().mark((function o(){return Object(r[\"a\"])().wrap((function(o){while(1)switch(o.prev=o.next){case 0:return o.next=2,g({coupons_id:e.coupons_id}).then((function(){t.$message.success(\"赠送成功\")}));case 2:case\"end\":return o.stop()}}),o)})))).catch((function(){}))},sendCoupon:function(e){var t=this;return Object(l[\"a\"])(Object(r[\"a\"])().mark((function o(){return Object(r[\"a\"])().wrap((function(o){while(1)switch(o.prev=o.next){case 0:t.giveDialog.form.coupons_id=e.coupons_id,t.giveDialog.show=!0;case 2:case\"end\":return o.stop()}}),o)})))()},changeNewStatus:function(e){var t=this;return Object(l[\"a\"])(Object(r[\"a\"])().mark((function o(){return Object(r[\"a\"])().wrap((function(o){while(1)switch(o.prev=o.next){case 0:return o.next=2,m({coupons_id:e.coupons_id,new_user_status:e.new_user_status}).then((function(){t.$message.success(\"修改成功\"),t.getCouponList()}));case 2:case\"end\":return o.stop()}}),o)})))()},submit:function(){var e=this;this.$refs[\"form\"].validate(function(){var t=Object(l[\"a\"])(Object(r[\"a\"])().mark((function t(o){return Object(r[\"a\"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!o){t.next=9;break}if(\"添加优惠券\"!==e.dialog.title){t.next=4;break}return t.next=4,d(e.dialog.form).then((function(){e.$message.success(\"添加成功\"),e.closeDialog(),e.getCouponList()}));case 4:if(\"修改优惠券\"!==e.dialog.title){t.next=7;break}return t.next=7,m(e.dialog.form).then((function(){e.$message.success(\"修改成功\"),e.closeDialog(),e.getCouponList()}));case 7:t.next=10;break;case 9:return t.abrupt(\"return\",!1);case 10:case\"end\":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},closeDialog:function(){this.dialog.form.title=\"\",this.dialog.form.money=\"\",this.dialog.form.coupons_id=\"\",this.dialog.form.new_user_status=0,this.dialog.form.day_number=1,this.$refs[\"form\"].resetFields(),this.dialog.show=!1},addCoupon:function(){this.dialog.title=\"添加优惠券\",this.dialog.show=!0},editCoupon:function(e){this.dialog.title=\"修改优惠券\",this.dialog.form.title=e.title,this.dialog.form.money=e.money,this.dialog.form.coupons_id=e.coupons_id,this.dialog.form.new_user_status=e.new_user_status,this.dialog.form.day_number=e.day_number,this.dialog.show=!0},delCoupon:function(e){var t=this;this.$confirm(\"您确定要删除该优惠券吗?\",\"温馨提示\",{cancelButtonText:\"点错了\",type:\"warning\"}).then(Object(l[\"a\"])(Object(r[\"a\"])().mark((function o(){return Object(r[\"a\"])().wrap((function(o){while(1)switch(o.prev=o.next){case 0:return o.next=2,p({coupons_id:e}).then((function(){t.$message.success(\"删除成功\"),t.Mix_tableData.currentPage=1,t.getCouponList()}));case 2:case\"end\":return o.stop()}}),o)})))).catch((function(){}))},getCouponList:function(){var e=this;return Object(l[\"a\"])(Object(r[\"a\"])().mark((function t(){return Object(r[\"a\"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,c({page:e.Mix_tableData.currentPage,limit:e.Mix_tableData.pageSize}).then((function(t){e.Mix_tableData.list=t.list,e.Mix_tableData.total=t.count}));case 2:case\"end\":return t.stop()}}),t)})))()}},mounted:function(){this.getCouponList()}},h=b,_=o(\"2877\"),v=Object(_[\"a\"])(h,i,s,!1,null,\"7aa8dbb3\",null),w=v.exports,x={name:\"coupon-manage\",components:{Index:w},data:function(){return{type:\"index\"}},methods:{changeComponents:function(e){this.type=e}}},y=x,D=Object(_[\"a\"])(y,n,a,!1,null,\"0fb75422\",null);t[\"default\"]=D.exports}}]);","extractedComments":[]}
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-667df97a"],{"02e7":function(t,e,n){"use strict";n("5f56")},"2c14":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"adv-manage"},["index"===t.type?n("Index",{on:{changeComponents:t.changeComponents}}):t._e(),"add"===t.type?n("Add",{on:{changeComponents:t.changeComponents}}):t._e(),"edit"===t.type?n("Edit",{on:{changeComponents:t.changeComponents}}):t._e()],1)},i=[],s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"adv-manage-index"},[n("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:t.addAdv}},[t._v("添加广告位")]),n("el-table",{ref:"table",staticClass:"mt15",attrs:{data:t.Mix_tableData.list,border:"",height:"calc(100vh - 225px)"},on:{"selection-change":function(e){return t.$selectionChange(e,"ad_id")}}},[n("el-table-column",{attrs:{type:"selection"}}),n("el-table-column",{attrs:{prop:"ad_id",label:"ID"}}),n("el-table-column",{attrs:{label:"图片",width:"300",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-image",{staticStyle:{width:"260px",height:"70px"},attrs:{src:t.baseUrl+e.row.src,fit:"cover","preview-src-list":[t.baseUrl+e.row.src]}})]}}])}),n("el-table-column",{attrs:{label:"状态"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-switch",{attrs:{"active-value":1,"inactive-value":0},on:{change:function(n){return t.statusChange(e.row)}},model:{value:e.row.status,callback:function(n){t.$set(e.row,"status",n)},expression:"scope.row.status"}})]}}])}),n("el-table-column",{attrs:{type:"action",label:"操作",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-button",{attrs:{type:"warning",size:"mini",icon:"el-icon-edit"},on:{click:function(n){return t.editAdv(e.row)}}},[t._v("编辑")]),n("el-button",{attrs:{type:"danger",size:"mini",icon:"el-icon-delete"},on:{click:function(n){return t.delAdv([e.row.ad_id])}}},[t._v("删除")])]}}])})],1),n("Pagination",{attrs:{tableData:t.Mix_tableData,getList:t.getAdvList},on:{pageChange:t.$pageChange}})],1)},o=[],c=n("c7eb"),r=n("1da1"),l=n("b775");function u(t){return Object(l["a"])({url:"/ad.Ad/list",method:"post",data:t})}function d(t){return Object(l["a"])({url:"/ad.Ad/add",method:"post",data:t})}function f(t){return Object(l["a"])({url:"/ad.Ad/edit",method:"post",data:t})}function m(t){return Object(l["a"])({url:"/ad.Ad/del",method:"post",data:t})}var h={data:function(){return{}},methods:{addAdv:function(){this.$emit("changeComponents","add")},editAdv:function(t){this.$store.commit("adv/setAdvData",t),this.$emit("changeComponents","edit")},delAdv:function(t){var e=this;this.$confirm("您确定要删除该广告位吗?","温馨提示",{cancelButtonText:"点错了",type:"warning"}).then(Object(r["a"])(Object(c["a"])().mark((function n(){return Object(c["a"])().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,m({ad_id:t}).then((function(){e.$message.success("删除成功"),e.Mix_tableData.currentPage=1,e.getAdvList()}));case 2:case"end":return n.stop()}}),n)})))).catch((function(){}))},statusChange:function(t){var e=this;return Object(r["a"])(Object(c["a"])().mark((function n(){return Object(c["a"])().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,f({ad_id:t.ad_id,status:t.status}).then((function(){e.$message.success("修改成功"),e.getAdvList()}));case 2:case"end":return n.stop()}}),n)})))()},getAdvList:function(){var t=this;return Object(r["a"])(Object(c["a"])().mark((function e(){return Object(c["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,u({page:t.Mix_tableData.currentPage,limit:t.Mix_tableData.pageSize}).then((function(e){t.Mix_tableData.list=e.list,t.Mix_tableData.total=e.count}));case 2:case"end":return e.stop()}}),e)})))()}},mounted:function(){this.getAdvList()}},p=h,b=(n("02e7"),n("2877")),g=Object(b["a"])(p,s,o,!1,null,"7155a76e",null),v=g.exports,y=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"adv-manage-add"},[n("el-button",{attrs:{icon:"el-icon-back"},on:{click:t.back}},[t._v("返回")]),n("el-row",{attrs:{type:"flex",align:"center",justify:"center"}},[n("el-col",{attrs:{span:12}},[n("el-form",{ref:"form",attrs:{model:t.form,rules:t.formRules,"label-width":"120px"}},[n("el-form-item",{attrs:{prop:"src",label:"图片"}},[n("el-upload",{attrs:{name:"file",action:t.uploadURL,"on-remove":t.uploadRemove,accept:".jpg,.jpeg,.png","on-success":t.uploadSuccess,limit:1}},[n("el-button",{attrs:{size:"small",type:"primary"}},[t._v("点击上传")]),n("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("只能上传 jpg/png 文件，尺寸为 1202*299")])],1)],1),n("el-form-item",{attrs:{prop:"status",label:"状态"}},[n("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}})],1),n("el-form-item",{attrs:{prop:"content",label:"广告内容"}},[n("tinymce",{ref:"tinymce",attrs:{height:300},model:{value:t.form.content,callback:function(e){t.$set(t.form,"content",e)},expression:"form.content"}})],1),n("el-form-item",[n("el-button",{attrs:{icon:"el-icon-back"},on:{click:t.back}},[t._v("返回")]),n("el-button",{attrs:{type:"primary",icon:"el-icon-check"},on:{click:t.submit}},[t._v("确定")])],1)],1)],1)],1)],1)},w=[],_=n("8256"),k={components:{Tinymce:_["a"]},data:function(){return{form:{src:"",status:1,content:""},formRules:{src:[{required:!0,message:"请上传图片"}],content:[{required:!0,message:"请输入内容"}]}}},methods:{uploadRemove:function(t,e){this.form.src=""},uploadSuccess:function(t,e,n){this.form.src=t.data},back:function(){this.$emit("changeComponents","index")},submit:function(){var t=this;this.$refs["form"].validate(function(){var e=Object(r["a"])(Object(c["a"])().mark((function e(n){return Object(c["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!n){e.next=5;break}return e.next=3,d(t.form).then((function(){t.$message.success("添加成功"),t.back()}));case 3:e.next=6;break;case 5:return e.abrupt("return",!1);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}}},j=k,x=Object(b["a"])(j,y,w,!1,null,"00e52534",null),C=x.exports,O=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"adv-manage-edit"},[n("el-button",{attrs:{icon:"el-icon-back"},on:{click:t.back}},[t._v("返回")]),n("el-row",{attrs:{type:"flex",align:"center",justify:"center"}},[n("el-col",{attrs:{span:12}},[n("el-form",{ref:"form",attrs:{model:t.form,rules:t.formRules,"label-width":"120px"}},[n("el-form-item",{attrs:{prop:"src",label:"图片"}},[n("el-upload",{attrs:{name:"file",action:t.uploadURL,"on-remove":t.uploadRemove,"file-list":t.fileList,accept:".jpg,.jpeg,.png","on-success":t.uploadSuccess,limit:1}},[n("el-button",{attrs:{size:"small",type:"primary"}},[t._v("点击上传")]),n("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("只能上传 jpg/png 文件，尺寸为 1202*299")])],1)],1),n("el-form-item",{attrs:{prop:"status",label:"状态"}},[n("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}})],1),n("el-form-item",{attrs:{prop:"content",label:"广告内容"}},[n("tinymce",{ref:"tinymce",attrs:{height:300},model:{value:t.form.content,callback:function(e){t.$set(t.form,"content",e)},expression:"form.content"}})],1),n("el-form-item",[n("el-button",{attrs:{icon:"el-icon-back"},on:{click:t.back}},[t._v("返回")]),n("el-button",{attrs:{type:"primary",icon:"el-icon-check"},on:{click:t.submit}},[t._v("确定")])],1)],1)],1)],1)],1)},$=[],S=n("5530"),A=n("2f62"),I={computed:Object(S["a"])({},Object(A["c"])({advData:function(t){return t["adv"].advData}})),components:{Tinymce:_["a"]},data:function(){return{fileList:[],form:{},formRules:{src:[{required:!0,message:"请上传图片"}],content:[{required:!0,message:"请输入内容"}]}}},methods:{uploadRemove:function(t,e){this.form.src=""},uploadSuccess:function(t,e,n){this.form.src=t.data},back:function(){this.$emit("changeComponents","index")},submit:function(){var t=this;this.$refs["form"].validate(function(){var e=Object(r["a"])(Object(c["a"])().mark((function e(n){return Object(c["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!n){e.next=5;break}return e.next=3,f(t.form).then((function(){t.$message.success("修改成功"),t.back()}));case 3:e.next=6;break;case 5:return e.abrupt("return",!1);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},mounted:function(){this.form=this.advData,this.fileList=[{name:this.form.src,url:this.form.src}]}},L=I,R=Object(b["a"])(L,O,$,!1,null,"c75ff2b2",null),U=R.exports,D={name:"adv-manage",components:{Index:v,Add:C,Edit:U},data:function(){return{type:"index"}},methods:{changeComponents:function(t){this.type=t}}},z=D,E=Object(b["a"])(z,a,i,!1,null,"36bbce7d",null);e["default"]=E.exports},"5f56":function(t,e,n){},"79a2":function(t,e,n){},8256:function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"tinymce-container",class:{fullscreen:t.fullscreen},style:{width:t.containerWidth}},[n("textarea",{staticClass:"tinymce-textarea",attrs:{id:t.tinymceId}}),t._v(" "),n("div",{staticClass:"editor-custom-btn-container"},[n("editorImage",{staticClass:"editor-upload-btn",attrs:{color:"#1890ff"},on:{successCBK:t.imageSuccessCBK}})],1)])},i=[],s=(n("b680"),n("a9e3"),n("ac1f"),n("00b4"),n("d3b7"),n("159b"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"upload-container"},[n("el-button",{style:{background:t.color,borderColor:t.color},attrs:{icon:"el-icon-upload",size:"mini",type:"primary"},on:{click:function(e){t.dialogVisible=!0}}},[t._v("上传")]),n("el-dialog",{attrs:{visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e}}},[n("el-upload",{staticClass:"editor-slide-upload",attrs:{multiple:!0,"file-list":t.fileList,"show-file-list":!0,"on-remove":t.handleRemove,"on-success":t.handleSuccess,"before-upload":t.beforeUpload,action:t.uploadURL,"list-type":"picture-card"}},[n("el-button",{attrs:{size:"small",type:"primary"}},[t._v("点击上传")])],1),n("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取消")]),n("el-button",{attrs:{type:"primary"},on:{click:t.handleSubmit}},[t._v("确定")])],1)],1)}),o=[],c=(n("ace4"),n("5cc6"),n("9a8c"),n("a975"),n("735e"),n("c1ac"),n("d139"),n("3a7b"),n("d5d6"),n("82f8"),n("e91f"),n("60bd"),n("5f96"),n("3280"),n("3fcc"),n("ca91"),n("25a1"),n("cd26"),n("3c5d"),n("2954"),n("649e"),n("219c"),n("170b"),n("b39a"),n("72f7"),n("b64b"),n("d81d"),n("3ca3"),n("ddb0"),n("2b3d"),n("9861"),{name:"EditorSlideUpload",props:{color:{type:String,default:"#1890ff"}},data:function(){return{dialogVisible:!1,listObj:{},fileList:[]}},methods:{scale:function(t){var e="image/jpeg"===t.type||"image/png"===t.type,n=t.size/1024/1024<10,a=t.size/1024/1024;if(e){if(n){var i=this;return new Promise((function(e){var n=new FileReader,s=new Image;s.onload=function(n){var o=document.createElement("canvas"),c=o.getContext("2d"),r=s.width,l=s.height,u=800,d=800,f=r,m=l;(r>u||l>d)&&(r/l>u/d?(f=u,m=Math.round(u*(l/r))):(m=d,f=Math.round(d*(r/l)))),o.width=f,o.height=m,c.clearRect(0,0,f,m),c.drawImage(s,0,0,f,m);var h=1;a<1&&a>.3&&(h=.9);var p=o.toDataURL("image/jpeg",h),b=i.dataURItoBlob(p,"image/jpeg");console.log(t.size/1024),console.log(b.size/1024),e(b)},n.onload=function(t){s.src=t.target.result},n.readAsDataURL(t)}))}this.$message.error("文件不能超过10M！")}else this.$message.error("文件格式错误！");return e&&n},dataURItoBlob:function(t,e){for(var n=atob(t.split(",")[1]),a=[],i=0;i<n.length;i++)a.push(n.charCodeAt(i));return new Blob([new Uint8Array(a)],{type:e})},checkAllSuccess:function(){var t=this;return Object.keys(this.listObj).every((function(e){return t.listObj[e].hasSuccess}))},handleSubmit:function(){var t=this,e=Object.keys(this.listObj).map((function(e){return t.listObj[e]}));this.checkAllSuccess()?(this.$emit("successCBK",e),this.listObj={},this.fileList=[],this.dialogVisible=!1):this.$message("Please wait for all images to be uploaded successfully. If there is a network problem, please refresh the page and upload again!")},handleSuccess:function(t,e){for(var n=e.uid,a=Object.keys(this.listObj),i=0,s=a.length;i<s;i++)if(this.listObj[a[i]].uid===n)return this.listObj[a[i]].url=this.baseUrl+t.data,void(this.listObj[a[i]].hasSuccess=!0)},handleRemove:function(t){for(var e=t.uid,n=Object.keys(this.listObj),a=0,i=n.length;a<i;a++)if(this.listObj[n[a]].uid===e)return void delete this.listObj[n[a]]},beforeUpload:function(t){this.scale(t);var e=this,n=window.URL||window.webkitURL,a=t.uid;return this.listObj[a]={},new Promise((function(i,s){var o=new Image;o.src=n.createObjectURL(t),o.onload=function(){e.listObj[a]={hasSuccess:!1,uid:t.uid,width:this.width,height:this.height}},i(!0)}))}}}),r=c,l=(n("b6d8"),n("2877")),u=Object(l["a"])(r,s,o,!1,null,"5b462b8b",null),d=u.exports,f=["advlist anchor autolink autosave code codesample colorpicker colorpicker contextmenu directionality emoticons fullscreen hr image imagetools insertdatetime link lists media nonbreaking noneditable pagebreak paste preview print save searchreplace spellchecker tabfocus table template textcolor textpattern visualblocks visualchars wordcount"],m=f,h=["searchreplace bold italic underline strikethrough alignleft aligncenter alignright outdent indent  blockquote undo redo removeformat subscript superscript code codesample","hr bullist numlist link image charmap preview anchor pagebreak insertdatetime media table emoticons forecolor backcolor fullscreen"],p=h,b=n("b85c"),g=[];function v(){return window.tinymce}var y=function(t,e){var n=document.getElementById(t),a=e||function(){};if(!n){var i=document.createElement("script");i.src=t,i.id=t,document.body.appendChild(i),g.push(a);var s="onload"in i?o:c;s(i)}function o(e){e.onload=function(){this.onerror=this.onload=null;var t,n=Object(b["a"])(g);try{for(n.s();!(t=n.n()).done;){var a=t.value;a(null,e)}}catch(i){n.e(i)}finally{n.f()}g=null},e.onerror=function(){this.onerror=this.onload=null,a(new Error("Failed to load "+t),e)}}function c(t){t.onreadystatechange=function(){if("complete"===this.readyState||"loaded"===this.readyState){this.onreadystatechange=null;var e,n=Object(b["a"])(g);try{for(n.s();!(e=n.n()).done;){var a=e.value;a(null,t)}}catch(i){n.e(i)}finally{n.f()}g=null}}}n&&a&&(v()?a(null,n):g.push(a))},w=y,_="https://file.seekr.cc/fwb/js/tinymce.min.js",k={name:"Tinymce",components:{editorImage:d},props:{id:{type:String,default:function(){return"vue-tinymce-"+ +new Date+(1e3*Math.random()).toFixed(0)}},value:{type:String,default:""},toolbar:{type:Array,required:!1,default:function(){return[]}},menubar:{type:String,default:"file edit insert view format table"},height:{type:[Number,String],required:!1,default:360},width:{type:[Number,String],required:!1,default:"auto"}},data:function(){return{hasChange:!1,hasInit:!1,tinymceId:this.id,fullscreen:!1,languageTypeList:{en:"en",zh:"zh_CN",es:"es_MX",ja:"ja"}}},computed:{containerWidth:function(){var t=this.width;return/^[\d]+(\.[\d]+)?$/.test(t)?"".concat(t,"px"):t}},watch:{value:function(t){var e=this;!this.hasChange&&this.hasInit&&this.$nextTick((function(){return window.tinymce.get(e.tinymceId).setContent(t||"")}))}},mounted:function(){this.init()},activated:function(){window.tinymce&&this.initTinymce()},deactivated:function(){this.destroyTinymce()},destroyed:function(){this.destroyTinymce()},methods:{init:function(){var t=this;w(_,(function(e){e?t.$message.error(e.message):t.initTinymce()}))},initTinymce:function(){var t=this,e=this;window.tinymce.init({selector:"#".concat(this.tinymceId),language:this.languageTypeList["zh"],height:this.height,body_class:"panel-body ",object_resizing:!1,toolbar:this.toolbar.length>0?this.toolbar:p,menubar:this.menubar,plugins:m,end_container_on_empty_block:!0,powerpaste_word_import:"clean",code_dialog_height:450,code_dialog_width:1e3,advlist_bullet_styles:"square",advlist_number_styles:"default",imagetools_cors_hosts:["www.tinymce.com","codepen.io"],default_link_target:"_blank",link_title:!1,nonbreaking_force_tab:!0,init_instance_callback:function(n){e.value&&n.setContent(e.value),e.hasInit=!0,n.on("NodeChange Change KeyUp SetContent",(function(){t.hasChange=!0,t.$emit("input",n.getContent())}))},setup:function(t){t.on("FullscreenStateChanged",(function(t){e.fullscreen=t.state}))},convert_urls:!1})},destroyTinymce:function(){var t=window.tinymce.get(this.tinymceId);this.fullscreen&&t.execCommand("mceFullScreen"),t&&t.destroy()},setContent:function(t){window.tinymce.get(this.tinymceId).setContent(t)},getContent:function(){window.tinymce.get(this.tinymceId).getContent()},imageSuccessCBK:function(t){var e=this;t.forEach((function(t){return window.tinymce.get(e.tinymceId).insertContent('<img class="wscnph" src="'.concat(t.url,'" >'))}))}}},j=k,x=(n("ac8b"),Object(l["a"])(j,a,i,!1,null,"ac80a932",null));e["a"]=x.exports},ac8b:function(t,e,n){"use strict";n("79a2")},b6d8:function(t,e,n){"use strict";n("f1c2")},f1c2:function(t,e,n){}}]);